/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ReplaySubject } from 'rxjs/index';
import { EASING } from './scroll-to-helpers';
/**
 * Scroll To Animation
 */
export class ScrollToAnimation {
    /**
     * Class Constructor.
     *
     * @param {?} _container            The Container
     * @param {?} _listenerTarget       The Element that listens for DOM Events
     * @param {?} _isWindow             Whether or not the listener is the Window
     * @param {?} _to                   Position to scroll to
     * @param {?} _options              Additional options for scrolling
     * @param {?} _isBrowser            Whether or not execution runs in the browser
     *                              (as opposed to the server)
     */
    constructor(_container, _listenerTarget, _isWindow, _to, _options, _isBrowser) {
        this._container = _container;
        this._listenerTarget = _listenerTarget;
        this._isWindow = _isWindow;
        this._to = _to;
        this._options = _options;
        this._isBrowser = _isBrowser;
        /**
         * Recursively loop over the Scroll Animation
         */
        this._loop = () => {
            this._timeLapsed += this._tick;
            this._percentage = (this._timeLapsed / this._options.duration);
            this._percentage = (this._percentage > 1) ? 1 : this._percentage;
            // Position Update
            this._position = this._startPosition +
                ((this._startPosition - this._to <= 0 ? 1 : -1) *
                    this._distance *
                    EASING[this._options.easing](this._percentage));
            if (this._lastPosition !== null && this._position === this._lastPosition) {
                this.stop();
            }
            else {
                this._source$.next(this._position);
                this._isWindow
                    ? this._listenerTarget.scrollTo(0, Math.floor(this._position))
                    : this._container.scrollTop = Math.floor(this._position);
                this._lastPosition = this._position;
            }
        };
        this._tick = 16;
        this._interval = null;
        this._lastPosition = null;
        this._timeLapsed = 0;
        this._windowScrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        if (!this._container) {
            this._startPosition = this._windowScrollTop;
        }
        else {
            this._startPosition = this._isWindow ? this._windowScrollTop : this._container.scrollTop;
        }
        // Correction for Starting Position of nested HTML Elements
        if (this._container && !this._isWindow) {
            this._to = this._to - this._container.getBoundingClientRect().top + this._startPosition;
        }
        // Set Distance
        /** @type {?} */
        const directionalDistance = this._startPosition - this._to;
        this._distance = this._container ? Math.abs(this._startPosition - this._to) : this._to;
        this._mappedOffset = this._options.offset;
        // Set offset from Offset Map
        if (this._isBrowser) {
            this._options
                .offsetMap
                .forEach((value, key) => this._mappedOffset = window.innerWidth > key ? value : this._mappedOffset);
        }
        this._distance += this._mappedOffset * (directionalDistance <= 0 ? 1 : -1);
        this._source$ = new ReplaySubject();
    }
    /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    start() {
        clearInterval(this._interval);
        this._interval = setInterval(this._loop, this._tick);
        return this._source$.asObservable();
    }
    /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    stop() {
        clearInterval(this._interval);
        this._interval = null;
        this._source$.complete();
    }
}
if (false) {
    /**
     * Number of milliseconds for each Tick
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._tick;
    /**
     * Interval
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._interval;
    /**
     * Time Lapsed in milliseconds
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._timeLapsed;
    /**
     * Percentage of time lapsed
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._percentage;
    /**
     * Position of the Element
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._position;
    /**
     * Last Element Position
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._lastPosition;
    /**
     * Start Position of the Element
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._startPosition;
    /**
     * The Distance to scroll
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._distance;
    /**
     * Observable Source
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._source$;
    /**
     * Scroll Top of the Window
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._windowScrollTop;
    /**
     * Mapped Offset taken from the active Offset Map
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._mappedOffset;
    /**
     * Recursively loop over the Scroll Animation
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._loop;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._container;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._listenerTarget;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._isWindow;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._to;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._options;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._isBrowser;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLXRvLWFuaW1hdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuaWNreS1sZW5hZXJzL25neC1zY3JvbGwtdG8vIiwic291cmNlcyI6WyJsaWIvc2Nyb2xsLXRvLWFuaW1hdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFjLGFBQWEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV2RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7QUFPN0MsTUFBTSxPQUFPLGlCQUFpQjs7Ozs7Ozs7Ozs7O0lBOEM1QixZQUNVLFVBQXVCLEVBQ3ZCLGVBQXVDLEVBQzlCLFNBQWtCLEVBQ2xCLEdBQVcsRUFDWCxRQUErQixFQUN4QyxVQUFtQjtRQUxuQixlQUFVLEdBQVYsVUFBVSxDQUFhO1FBQ3ZCLG9CQUFlLEdBQWYsZUFBZSxDQUF3QjtRQUM5QixjQUFTLEdBQVQsU0FBUyxDQUFTO1FBQ2xCLFFBQUcsR0FBSCxHQUFHLENBQVE7UUFDWCxhQUFRLEdBQVIsUUFBUSxDQUF1QjtRQUN4QyxlQUFVLEdBQVYsVUFBVSxDQUFTOzs7O1FBaURyQixVQUFLLEdBQUcsR0FBUyxFQUFFO1lBRXpCLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMvQixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9ELElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7WUFFakUsa0JBQWtCO1lBQ2xCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWM7Z0JBQ2xDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxHQUFH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RUQsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsbUJBQW1CLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0UsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLGFBQWEsRUFBRSxDQUFDO0lBQ3RDLENBQUM7Ozs7OztJQU9NLEtBQUs7UUFDVixhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0QyxDQUFDOzs7Ozs7SUFnQ00sSUFBSTtRQUNULGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUMzQixDQUFDO0NBQ0Y7Ozs7Ozs7SUFwSUMsa0NBQXNCOzs7Ozs7SUFHdEIsc0NBQXVCOzs7Ozs7SUFHdkIsd0NBQTRCOzs7Ozs7SUFHNUIsd0NBQTRCOzs7Ozs7SUFHNUIsc0NBQTBCOzs7Ozs7SUFHMUIsMENBQThCOzs7Ozs7SUFHOUIsMkNBQStCOzs7Ozs7SUFHL0Isc0NBQTBCOzs7Ozs7SUFHMUIscUNBQXdDOzs7Ozs7SUFHeEMsNkNBQWlDOzs7Ozs7SUFHakMsMENBQThCOzs7Ozs7SUFvRTlCLGtDQXFCQzs7Ozs7SUEzRUMsdUNBQStCOzs7OztJQUMvQiw0Q0FBK0M7Ozs7O0lBQy9DLHNDQUFtQzs7Ozs7SUFDbkMsZ0NBQTRCOzs7OztJQUM1QixxQ0FBZ0Q7Ozs7O0lBQ2hELHVDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzL2luZGV4JztcclxuXHJcbmltcG9ydCB7IEVBU0lORyB9IGZyb20gJy4vc2Nyb2xsLXRvLWhlbHBlcnMnO1xyXG5pbXBvcnQge1xyXG4gIFNjcm9sbFRvQ29uZmlnT3B0aW9ucyxcclxuICBTY3JvbGxUb0xpc3RlbmVyVGFyZ2V0XHJcbn0gZnJvbSAnLi9zY3JvbGwtdG8tY29uZmlnLmludGVyZmFjZSc7XHJcblxyXG4vKiogU2Nyb2xsIFRvIEFuaW1hdGlvbiAqL1xyXG5leHBvcnQgY2xhc3MgU2Nyb2xsVG9BbmltYXRpb24ge1xyXG5cclxuICAvKiogTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBmb3IgZWFjaCBUaWNrICovXHJcbiAgcHJpdmF0ZSBfdGljazogbnVtYmVyO1xyXG5cclxuICAvKiogSW50ZXJ2YWwgKi9cclxuICBwcml2YXRlIF9pbnRlcnZhbDogYW55O1xyXG5cclxuICAvKiogVGltZSBMYXBzZWQgaW4gbWlsbGlzZWNvbmRzICovXHJcbiAgcHJpdmF0ZSBfdGltZUxhcHNlZDogbnVtYmVyO1xyXG5cclxuICAvKiogUGVyY2VudGFnZSBvZiB0aW1lIGxhcHNlZCAqL1xyXG4gIHByaXZhdGUgX3BlcmNlbnRhZ2U6IG51bWJlcjtcclxuXHJcbiAgLyoqIFBvc2l0aW9uIG9mIHRoZSBFbGVtZW50ICovXHJcbiAgcHJpdmF0ZSBfcG9zaXRpb246IG51bWJlcjtcclxuXHJcbiAgLyoqIExhc3QgRWxlbWVudCBQb3NpdGlvbiAqL1xyXG4gIHByaXZhdGUgX2xhc3RQb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvKiogU3RhcnQgUG9zaXRpb24gb2YgdGhlIEVsZW1lbnQgKi9cclxuICBwcml2YXRlIF9zdGFydFBvc2l0aW9uOiBudW1iZXI7XHJcblxyXG4gIC8qKiBUaGUgRGlzdGFuY2UgdG8gc2Nyb2xsICovXHJcbiAgcHJpdmF0ZSBfZGlzdGFuY2U6IG51bWJlcjtcclxuXHJcbiAgLyoqIE9ic2VydmFibGUgU291cmNlICovXHJcbiAgcHJpdmF0ZSBfc291cmNlJDogUmVwbGF5U3ViamVjdDxudW1iZXI+O1xyXG5cclxuICAvKiogU2Nyb2xsIFRvcCBvZiB0aGUgV2luZG93ICovXHJcbiAgcHJpdmF0ZSBfd2luZG93U2Nyb2xsVG9wOiBudW1iZXI7XHJcblxyXG4gIC8qKiBNYXBwZWQgT2Zmc2V0IHRha2VuIGZyb20gdGhlIGFjdGl2ZSBPZmZzZXQgTWFwICovXHJcbiAgcHJpdmF0ZSBfbWFwcGVkT2Zmc2V0OiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIENsYXNzIENvbnN0cnVjdG9yLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIF9jb250YWluZXIgICAgICAgICAgICBUaGUgQ29udGFpbmVyXHJcbiAgICogQHBhcmFtIF9saXN0ZW5lclRhcmdldCAgICAgICBUaGUgRWxlbWVudCB0aGF0IGxpc3RlbnMgZm9yIERPTSBFdmVudHNcclxuICAgKiBAcGFyYW0gX2lzV2luZG93ICAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRoZSBsaXN0ZW5lciBpcyB0aGUgV2luZG93XHJcbiAgICogQHBhcmFtIF90byAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiB0byBzY3JvbGwgdG9cclxuICAgKiBAcGFyYW0gX29wdGlvbnMgICAgICAgICAgICAgIEFkZGl0aW9uYWwgb3B0aW9ucyBmb3Igc2Nyb2xsaW5nXHJcbiAgICogQHBhcmFtIF9pc0Jyb3dzZXIgICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCBleGVjdXRpb24gcnVucyBpbiB0aGUgYnJvd3NlclxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFzIG9wcG9zZWQgdG8gdGhlIHNlcnZlcilcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgX2NvbnRhaW5lcjogSFRNTEVsZW1lbnQsXHJcbiAgICBwcml2YXRlIF9saXN0ZW5lclRhcmdldDogU2Nyb2xsVG9MaXN0ZW5lclRhcmdldCxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX2lzV2luZG93OiBib29sZWFuLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfdG86IG51bWJlcixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX29wdGlvbnM6IFNjcm9sbFRvQ29uZmlnT3B0aW9ucyxcclxuICAgIHByaXZhdGUgX2lzQnJvd3NlcjogYm9vbGVhblxyXG4gICkge1xyXG4gICAgdGhpcy5fdGljayA9IDE2O1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBudWxsO1xyXG4gICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gbnVsbDtcclxuICAgIHRoaXMuX3RpbWVMYXBzZWQgPSAwO1xyXG5cclxuICAgIHRoaXMuX3dpbmRvd1Njcm9sbFRvcCA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IDA7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9jb250YWluZXIpIHtcclxuICAgICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IHRoaXMuX3dpbmRvd1Njcm9sbFRvcDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N0YXJ0UG9zaXRpb24gPSB0aGlzLl9pc1dpbmRvdyA/IHRoaXMuX3dpbmRvd1Njcm9sbFRvcCA6IHRoaXMuX2NvbnRhaW5lci5zY3JvbGxUb3A7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29ycmVjdGlvbiBmb3IgU3RhcnRpbmcgUG9zaXRpb24gb2YgbmVzdGVkIEhUTUwgRWxlbWVudHNcclxuICAgIGlmICh0aGlzLl9jb250YWluZXIgJiYgIXRoaXMuX2lzV2luZG93KSB7XHJcbiAgICAgIHRoaXMuX3RvID0gdGhpcy5fdG8gLSB0aGlzLl9jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgdGhpcy5fc3RhcnRQb3NpdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgRGlzdGFuY2VcclxuICAgIGNvbnN0IGRpcmVjdGlvbmFsRGlzdGFuY2UgPSB0aGlzLl9zdGFydFBvc2l0aW9uIC0gdGhpcy5fdG87XHJcbiAgICB0aGlzLl9kaXN0YW5jZSA9IHRoaXMuX2NvbnRhaW5lciA/IE1hdGguYWJzKHRoaXMuX3N0YXJ0UG9zaXRpb24gLSB0aGlzLl90bykgOiB0aGlzLl90bztcclxuXHJcbiAgICB0aGlzLl9tYXBwZWRPZmZzZXQgPSB0aGlzLl9vcHRpb25zLm9mZnNldDtcclxuXHJcbiAgICAvLyBTZXQgb2Zmc2V0IGZyb20gT2Zmc2V0IE1hcFxyXG4gICAgaWYgKHRoaXMuX2lzQnJvd3Nlcikge1xyXG4gICAgICB0aGlzLl9vcHRpb25zXHJcbiAgICAgICAgLm9mZnNldE1hcFxyXG4gICAgICAgIC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB0aGlzLl9tYXBwZWRPZmZzZXQgPSB3aW5kb3cuaW5uZXJXaWR0aCA+IGtleSA/IHZhbHVlIDogdGhpcy5fbWFwcGVkT2Zmc2V0KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9kaXN0YW5jZSArPSB0aGlzLl9tYXBwZWRPZmZzZXQgKiAoZGlyZWN0aW9uYWxEaXN0YW5jZSA8PSAwID8gMSA6IC0xKTtcclxuICAgIHRoaXMuX3NvdXJjZSQgPSBuZXcgUmVwbGF5U3ViamVjdCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgdGhlIG5ldyBTY3JvbGwgQW5pbWF0aW9uLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMgICAgICAgICBPYnNlcnZhYmxlIGNvbnRhaW5pbmcgYSBudW1iZXJcclxuICAgKi9cclxuICBwdWJsaWMgc3RhcnQoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWwpO1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLl9sb29wLCB0aGlzLl90aWNrKTtcclxuICAgIHJldHVybiB0aGlzLl9zb3VyY2UkLmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqIFJlY3Vyc2l2ZWx5IGxvb3Agb3ZlciB0aGUgU2Nyb2xsIEFuaW1hdGlvbiAqL1xyXG4gIHByaXZhdGUgX2xvb3AgPSAoKTogdm9pZCA9PiB7XHJcblxyXG4gICAgdGhpcy5fdGltZUxhcHNlZCArPSB0aGlzLl90aWNrO1xyXG4gICAgdGhpcy5fcGVyY2VudGFnZSA9ICh0aGlzLl90aW1lTGFwc2VkIC8gdGhpcy5fb3B0aW9ucy5kdXJhdGlvbik7XHJcbiAgICB0aGlzLl9wZXJjZW50YWdlID0gKHRoaXMuX3BlcmNlbnRhZ2UgPiAxKSA/IDEgOiB0aGlzLl9wZXJjZW50YWdlO1xyXG5cclxuICAgIC8vIFBvc2l0aW9uIFVwZGF0ZVxyXG4gICAgdGhpcy5fcG9zaXRpb24gPSB0aGlzLl9zdGFydFBvc2l0aW9uICtcclxuICAgICAgKCh0aGlzLl9zdGFydFBvc2l0aW9uIC0gdGhpcy5fdG8gPD0gMCA/IDEgOiAtMSkgKlxyXG4gICAgICAgIHRoaXMuX2Rpc3RhbmNlICpcclxuICAgICAgICBFQVNJTkdbdGhpcy5fb3B0aW9ucy5lYXNpbmddKHRoaXMuX3BlcmNlbnRhZ2UpKTtcclxuXHJcbiAgICBpZiAodGhpcy5fbGFzdFBvc2l0aW9uICE9PSBudWxsICYmIHRoaXMuX3Bvc2l0aW9uID09PSB0aGlzLl9sYXN0UG9zaXRpb24pIHtcclxuICAgICAgdGhpcy5zdG9wKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9zb3VyY2UkLm5leHQodGhpcy5fcG9zaXRpb24pO1xyXG4gICAgICB0aGlzLl9pc1dpbmRvd1xyXG4gICAgICAgID8gdGhpcy5fbGlzdGVuZXJUYXJnZXQuc2Nyb2xsVG8oMCwgTWF0aC5mbG9vcih0aGlzLl9wb3NpdGlvbikpXHJcbiAgICAgICAgOiB0aGlzLl9jb250YWluZXIuc2Nyb2xsVG9wID0gTWF0aC5mbG9vcih0aGlzLl9wb3NpdGlvbik7XHJcbiAgICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IHRoaXMuX3Bvc2l0aW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcCB0aGUgY3VycmVudCBTY3JvbGwgQW5pbWF0aW9uIExvb3AuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gZm9yY2UgXHRcdFx0ICAgIEZvcmNlIHRvIHN0b3AgdGhlIEFuaW1hdGlvbiBMb29wXHJcbiAgICogQHJldHVybnMgICAgICAgICAgICAgICBWb2lkXHJcbiAgICovXHJcbiAgcHVibGljIHN0b3AoKTogdm9pZCB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsKTtcclxuICAgIHRoaXMuX2ludGVydmFsID0gbnVsbDtcclxuICAgIHRoaXMuX3NvdXJjZSQuY29tcGxldGUoKTtcclxuICB9XHJcbn1cclxuIl19