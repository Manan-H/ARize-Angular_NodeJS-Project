/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ReplaySubject } from 'rxjs/index';
import { EASING } from './scroll-to-helpers';
/**
 * Scroll To Animation
 */
var /**
 * Scroll To Animation
 */
ScrollToAnimation = /** @class */ (function () {
    /**
     * Class Constructor.
     *
     * @param _container            The Container
     * @param _listenerTarget       The Element that listens for DOM Events
     * @param _isWindow             Whether or not the listener is the Window
     * @param _to                   Position to scroll to
     * @param _options              Additional options for scrolling
     * @param _isBrowser            Whether or not execution runs in the browser
     *                              (as opposed to the server)
     */
    function ScrollToAnimation(_container, _listenerTarget, _isWindow, _to, _options, _isBrowser) {
        var _this = this;
        this._container = _container;
        this._listenerTarget = _listenerTarget;
        this._isWindow = _isWindow;
        this._to = _to;
        this._options = _options;
        this._isBrowser = _isBrowser;
        /**
         * Recursively loop over the Scroll Animation
         */
        this._loop = function () {
            _this._timeLapsed += _this._tick;
            _this._percentage = (_this._timeLapsed / _this._options.duration);
            _this._percentage = (_this._percentage > 1) ? 1 : _this._percentage;
            // Position Update
            _this._position = _this._startPosition +
                ((_this._startPosition - _this._to <= 0 ? 1 : -1) *
                    _this._distance *
                    EASING[_this._options.easing](_this._percentage));
            if (_this._lastPosition !== null && _this._position === _this._lastPosition) {
                _this.stop();
            }
            else {
                _this._source$.next(_this._position);
                _this._isWindow
                    ? _this._listenerTarget.scrollTo(0, Math.floor(_this._position))
                    : _this._container.scrollTop = Math.floor(_this._position);
                _this._lastPosition = _this._position;
            }
        };
        this._tick = 16;
        this._interval = null;
        this._lastPosition = null;
        this._timeLapsed = 0;
        this._windowScrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        if (!this._container) {
            this._startPosition = this._windowScrollTop;
        }
        else {
            this._startPosition = this._isWindow ? this._windowScrollTop : this._container.scrollTop;
        }
        // Correction for Starting Position of nested HTML Elements
        if (this._container && !this._isWindow) {
            this._to = this._to - this._container.getBoundingClientRect().top + this._startPosition;
        }
        // Set Distance
        /** @type {?} */
        var directionalDistance = this._startPosition - this._to;
        this._distance = this._container ? Math.abs(this._startPosition - this._to) : this._to;
        this._mappedOffset = this._options.offset;
        // Set offset from Offset Map
        if (this._isBrowser) {
            this._options
                .offsetMap
                .forEach(function (value, key) { return _this._mappedOffset = window.innerWidth > key ? value : _this._mappedOffset; });
        }
        this._distance += this._mappedOffset * (directionalDistance <= 0 ? 1 : -1);
        this._source$ = new ReplaySubject();
    }
    /**
     * Start the new Scroll Animation.
     *
     * @returns         Observable containing a number
     */
    /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    ScrollToAnimation.prototype.start = /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    function () {
        clearInterval(this._interval);
        this._interval = setInterval(this._loop, this._tick);
        return this._source$.asObservable();
    };
    /**
     * Stop the current Scroll Animation Loop.
     *
     * @param force 			    Force to stop the Animation Loop
     * @returns               Void
     */
    /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    ScrollToAnimation.prototype.stop = /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    function () {
        clearInterval(this._interval);
        this._interval = null;
        this._source$.complete();
    };
    return ScrollToAnimation;
}());
/**
 * Scroll To Animation
 */
export { ScrollToAnimation };
if (false) {
    /**
     * Number of milliseconds for each Tick
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._tick;
    /**
     * Interval
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._interval;
    /**
     * Time Lapsed in milliseconds
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._timeLapsed;
    /**
     * Percentage of time lapsed
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._percentage;
    /**
     * Position of the Element
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._position;
    /**
     * Last Element Position
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._lastPosition;
    /**
     * Start Position of the Element
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._startPosition;
    /**
     * The Distance to scroll
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._distance;
    /**
     * Observable Source
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._source$;
    /**
     * Scroll Top of the Window
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._windowScrollTop;
    /**
     * Mapped Offset taken from the active Offset Map
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._mappedOffset;
    /**
     * Recursively loop over the Scroll Animation
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._loop;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._container;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._listenerTarget;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._isWindow;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._to;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._options;
    /**
     * @type {?}
     * @private
     */
    ScrollToAnimation.prototype._isBrowser;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLXRvLWFuaW1hdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuaWNreS1sZW5hZXJzL25neC1zY3JvbGwtdG8vIiwic291cmNlcyI6WyJsaWIvc2Nyb2xsLXRvLWFuaW1hdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFjLGFBQWEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV2RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7QUFPN0M7Ozs7SUFtQ0U7Ozs7Ozs7Ozs7T0FVRztJQUNILDJCQUNVLFVBQXVCLEVBQ3ZCLGVBQXVDLEVBQzlCLFNBQWtCLEVBQ2xCLEdBQVcsRUFDWCxRQUErQixFQUN4QyxVQUFtQjtRQU43QixpQkF5Q0M7UUF4Q1MsZUFBVSxHQUFWLFVBQVUsQ0FBYTtRQUN2QixvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDOUIsY0FBUyxHQUFULFNBQVMsQ0FBUztRQUNsQixRQUFHLEdBQUgsR0FBRyxDQUFRO1FBQ1gsYUFBUSxHQUFSLFFBQVEsQ0FBdUI7UUFDeEMsZUFBVSxHQUFWLFVBQVUsQ0FBUzs7OztRQWlEckIsVUFBSyxHQUFHO1lBRWQsS0FBSSxDQUFDLFdBQVcsSUFBSSxLQUFJLENBQUMsS0FBSyxDQUFDO1lBQy9CLEtBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxLQUFJLENBQUMsV0FBVyxHQUFHLEtBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDL0QsS0FBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLEtBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQztZQUVqRSxrQkFBa0I7WUFDbEIsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFJLENBQUMsY0FBYztnQkFDbEMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSSxDQUFDLEdBQUcsSUFB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QWdEOzs7OztJQUNoRCx1Q0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcy9pbmRleCc7XHJcblxyXG5pbXBvcnQgeyBFQVNJTkcgfSBmcm9tICcuL3Njcm9sbC10by1oZWxwZXJzJztcclxuaW1wb3J0IHtcclxuICBTY3JvbGxUb0NvbmZpZ09wdGlvbnMsXHJcbiAgU2Nyb2xsVG9MaXN0ZW5lclRhcmdldFxyXG59IGZyb20gJy4vc2Nyb2xsLXRvLWNvbmZpZy5pbnRlcmZhY2UnO1xyXG5cclxuLyoqIFNjcm9sbCBUbyBBbmltYXRpb24gKi9cclxuZXhwb3J0IGNsYXNzIFNjcm9sbFRvQW5pbWF0aW9uIHtcclxuXHJcbiAgLyoqIE51bWJlciBvZiBtaWxsaXNlY29uZHMgZm9yIGVhY2ggVGljayAqL1xyXG4gIHByaXZhdGUgX3RpY2s6IG51bWJlcjtcclxuXHJcbiAgLyoqIEludGVydmFsICovXHJcbiAgcHJpdmF0ZSBfaW50ZXJ2YWw6IGFueTtcclxuXHJcbiAgLyoqIFRpbWUgTGFwc2VkIGluIG1pbGxpc2Vjb25kcyAqL1xyXG4gIHByaXZhdGUgX3RpbWVMYXBzZWQ6IG51bWJlcjtcclxuXHJcbiAgLyoqIFBlcmNlbnRhZ2Ugb2YgdGltZSBsYXBzZWQgKi9cclxuICBwcml2YXRlIF9wZXJjZW50YWdlOiBudW1iZXI7XHJcblxyXG4gIC8qKiBQb3NpdGlvbiBvZiB0aGUgRWxlbWVudCAqL1xyXG4gIHByaXZhdGUgX3Bvc2l0aW9uOiBudW1iZXI7XHJcblxyXG4gIC8qKiBMYXN0IEVsZW1lbnQgUG9zaXRpb24gKi9cclxuICBwcml2YXRlIF9sYXN0UG9zaXRpb246IG51bWJlcjtcclxuXHJcbiAgLyoqIFN0YXJ0IFBvc2l0aW9uIG9mIHRoZSBFbGVtZW50ICovXHJcbiAgcHJpdmF0ZSBfc3RhcnRQb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvKiogVGhlIERpc3RhbmNlIHRvIHNjcm9sbCAqL1xyXG4gIHByaXZhdGUgX2Rpc3RhbmNlOiBudW1iZXI7XHJcblxyXG4gIC8qKiBPYnNlcnZhYmxlIFNvdXJjZSAqL1xyXG4gIHByaXZhdGUgX3NvdXJjZSQ6IFJlcGxheVN1YmplY3Q8bnVtYmVyPjtcclxuXHJcbiAgLyoqIFNjcm9sbCBUb3Agb2YgdGhlIFdpbmRvdyAqL1xyXG4gIHByaXZhdGUgX3dpbmRvd1Njcm9sbFRvcDogbnVtYmVyO1xyXG5cclxuICAvKiogTWFwcGVkIE9mZnNldCB0YWtlbiBmcm9tIHRoZSBhY3RpdmUgT2Zmc2V0IE1hcCAqL1xyXG4gIHByaXZhdGUgX21hcHBlZE9mZnNldDogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBDbGFzcyBDb25zdHJ1Y3Rvci5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBfY29udGFpbmVyICAgICAgICAgICAgVGhlIENvbnRhaW5lclxyXG4gICAqIEBwYXJhbSBfbGlzdGVuZXJUYXJnZXQgICAgICAgVGhlIEVsZW1lbnQgdGhhdCBsaXN0ZW5zIGZvciBET00gRXZlbnRzXHJcbiAgICogQHBhcmFtIF9pc1dpbmRvdyAgICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCB0aGUgbGlzdGVuZXIgaXMgdGhlIFdpbmRvd1xyXG4gICAqIEBwYXJhbSBfdG8gICAgICAgICAgICAgICAgICAgUG9zaXRpb24gdG8gc2Nyb2xsIHRvXHJcbiAgICogQHBhcmFtIF9vcHRpb25zICAgICAgICAgICAgICBBZGRpdGlvbmFsIG9wdGlvbnMgZm9yIHNjcm9sbGluZ1xyXG4gICAqIEBwYXJhbSBfaXNCcm93c2VyICAgICAgICAgICAgV2hldGhlciBvciBub3QgZXhlY3V0aW9uIHJ1bnMgaW4gdGhlIGJyb3dzZXJcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhcyBvcHBvc2VkIHRvIHRoZSBzZXJ2ZXIpXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9jb250YWluZXI6IEhUTUxFbGVtZW50LFxyXG4gICAgcHJpdmF0ZSBfbGlzdGVuZXJUYXJnZXQ6IFNjcm9sbFRvTGlzdGVuZXJUYXJnZXQsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9pc1dpbmRvdzogYm9vbGVhbixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX3RvOiBudW1iZXIsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9vcHRpb25zOiBTY3JvbGxUb0NvbmZpZ09wdGlvbnMsXHJcbiAgICBwcml2YXRlIF9pc0Jyb3dzZXI6IGJvb2xlYW5cclxuICApIHtcclxuICAgIHRoaXMuX3RpY2sgPSAxNjtcclxuICAgIHRoaXMuX2ludGVydmFsID0gbnVsbDtcclxuICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IG51bGw7XHJcbiAgICB0aGlzLl90aW1lTGFwc2VkID0gMDtcclxuXHJcbiAgICB0aGlzLl93aW5kb3dTY3JvbGxUb3AgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB8fCAwO1xyXG5cclxuICAgIGlmICghdGhpcy5fY29udGFpbmVyKSB7XHJcbiAgICAgIHRoaXMuX3N0YXJ0UG9zaXRpb24gPSB0aGlzLl93aW5kb3dTY3JvbGxUb3A7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9zdGFydFBvc2l0aW9uID0gdGhpcy5faXNXaW5kb3cgPyB0aGlzLl93aW5kb3dTY3JvbGxUb3AgOiB0aGlzLl9jb250YWluZXIuc2Nyb2xsVG9wO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvcnJlY3Rpb24gZm9yIFN0YXJ0aW5nIFBvc2l0aW9uIG9mIG5lc3RlZCBIVE1MIEVsZW1lbnRzXHJcbiAgICBpZiAodGhpcy5fY29udGFpbmVyICYmICF0aGlzLl9pc1dpbmRvdykge1xyXG4gICAgICB0aGlzLl90byA9IHRoaXMuX3RvIC0gdGhpcy5fY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArIHRoaXMuX3N0YXJ0UG9zaXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IERpc3RhbmNlXHJcbiAgICBjb25zdCBkaXJlY3Rpb25hbERpc3RhbmNlID0gdGhpcy5fc3RhcnRQb3NpdGlvbiAtIHRoaXMuX3RvO1xyXG4gICAgdGhpcy5fZGlzdGFuY2UgPSB0aGlzLl9jb250YWluZXIgPyBNYXRoLmFicyh0aGlzLl9zdGFydFBvc2l0aW9uIC0gdGhpcy5fdG8pIDogdGhpcy5fdG87XHJcblxyXG4gICAgdGhpcy5fbWFwcGVkT2Zmc2V0ID0gdGhpcy5fb3B0aW9ucy5vZmZzZXQ7XHJcblxyXG4gICAgLy8gU2V0IG9mZnNldCBmcm9tIE9mZnNldCBNYXBcclxuICAgIGlmICh0aGlzLl9pc0Jyb3dzZXIpIHtcclxuICAgICAgdGhpcy5fb3B0aW9uc1xyXG4gICAgICAgIC5vZmZzZXRNYXBcclxuICAgICAgICAuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4gdGhpcy5fbWFwcGVkT2Zmc2V0ID0gd2luZG93LmlubmVyV2lkdGggPiBrZXkgPyB2YWx1ZSA6IHRoaXMuX21hcHBlZE9mZnNldCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fZGlzdGFuY2UgKz0gdGhpcy5fbWFwcGVkT2Zmc2V0ICogKGRpcmVjdGlvbmFsRGlzdGFuY2UgPD0gMCA/IDEgOiAtMSk7XHJcbiAgICB0aGlzLl9zb3VyY2UkID0gbmV3IFJlcGxheVN1YmplY3QoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IHRoZSBuZXcgU2Nyb2xsIEFuaW1hdGlvbi5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zICAgICAgICAgT2JzZXJ2YWJsZSBjb250YWluaW5nIGEgbnVtYmVyXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXJ0KCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsKTtcclxuICAgIHRoaXMuX2ludGVydmFsID0gc2V0SW50ZXJ2YWwodGhpcy5fbG9vcCwgdGhpcy5fdGljayk7XHJcbiAgICByZXR1cm4gdGhpcy5fc291cmNlJC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKiBSZWN1cnNpdmVseSBsb29wIG92ZXIgdGhlIFNjcm9sbCBBbmltYXRpb24gKi9cclxuICBwcml2YXRlIF9sb29wID0gKCk6IHZvaWQgPT4ge1xyXG5cclxuICAgIHRoaXMuX3RpbWVMYXBzZWQgKz0gdGhpcy5fdGljaztcclxuICAgIHRoaXMuX3BlcmNlbnRhZ2UgPSAodGhpcy5fdGltZUxhcHNlZCAvIHRoaXMuX29wdGlvbnMuZHVyYXRpb24pO1xyXG4gICAgdGhpcy5fcGVyY2VudGFnZSA9ICh0aGlzLl9wZXJjZW50YWdlID4gMSkgPyAxIDogdGhpcy5fcGVyY2VudGFnZTtcclxuXHJcbiAgICAvLyBQb3NpdGlvbiBVcGRhdGVcclxuICAgIHRoaXMuX3Bvc2l0aW9uID0gdGhpcy5fc3RhcnRQb3NpdGlvbiArXHJcbiAgICAgICgodGhpcy5fc3RhcnRQb3NpdGlvbiAtIHRoaXMuX3RvIDw9IDAgPyAxIDogLTEpICpcclxuICAgICAgICB0aGlzLl9kaXN0YW5jZSAqXHJcbiAgICAgICAgRUFTSU5HW3RoaXMuX29wdGlvbnMuZWFzaW5nXSh0aGlzLl9wZXJjZW50YWdlKSk7XHJcblxyXG4gICAgaWYgKHRoaXMuX2xhc3RQb3NpdGlvbiAhPT0gbnVsbCAmJiB0aGlzLl9wb3NpdGlvbiA9PT0gdGhpcy5fbGFzdFBvc2l0aW9uKSB7XHJcbiAgICAgIHRoaXMuc3RvcCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc291cmNlJC5uZXh0KHRoaXMuX3Bvc2l0aW9uKTtcclxuICAgICAgdGhpcy5faXNXaW5kb3dcclxuICAgICAgICA/IHRoaXMuX2xpc3RlbmVyVGFyZ2V0LnNjcm9sbFRvKDAsIE1hdGguZmxvb3IodGhpcy5fcG9zaXRpb24pKVxyXG4gICAgICAgIDogdGhpcy5fY29udGFpbmVyLnNjcm9sbFRvcCA9IE1hdGguZmxvb3IodGhpcy5fcG9zaXRpb24pO1xyXG4gICAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl9wb3NpdGlvbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3AgdGhlIGN1cnJlbnQgU2Nyb2xsIEFuaW1hdGlvbiBMb29wLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGZvcmNlIFx0XHRcdCAgICBGb3JjZSB0byBzdG9wIHRoZSBBbmltYXRpb24gTG9vcFxyXG4gICAqIEByZXR1cm5zICAgICAgICAgICAgICAgVm9pZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wKCk6IHZvaWQge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9pbnRlcnZhbCk7XHJcbiAgICB0aGlzLl9pbnRlcnZhbCA9IG51bGw7XHJcbiAgICB0aGlzLl9zb3VyY2UkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==